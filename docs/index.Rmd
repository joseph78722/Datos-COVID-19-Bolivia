---
title: "Bolivia: datos COVID-19"
author: '**Elaboración**: José Romero      **Fuente**: Ministerio de Salud     **Actualizado**: 20-05-2020'
output: 
  flexdashboard::flex_dashboard:
    logo: "C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\icono3.png"
    vertical_layout: scroll
    orientation: row
    theme: cerulean
---
Column {data-height=110}
-------------------------------------
### 
```{r}
library(dygraphs)
library(readr)
library(tidyverse)
library(xts)
library(plotly)
library(ggthemes)
library(readr)
library(flexdashboard)
library(viridis)
library(hrbrthemes)
library(highcharter)

Conf <- read_csv("C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\data\\Confirmados.csv", 
                        col_types = cols(`Casos confirmados` = col_integer(), 
                                         Fecha = col_date(format = "%d/%m/%Y")))
valor1 <- max(Conf$`Casos confirmados`, na.rm = FALSE)

valueBox(valor1, caption = "Casos confirmados", color  = '#5B89E2', "icon = fas fa-users")
         
    ```

### 
```{r}

Rec <- read_csv("C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\data\\Recuperados.csv", 
                        col_types = cols(Fecha = col_date(format = "%d/%m/%Y"), 
                                         Recuperados = col_integer()))
valor2 <- last(Rec$Recuperados, na.rm = FALSE)
valueBox(valor2, caption = "Recuperados", color  = '#00AC37', icon = "glyphicon glyphicon-ok")
    ```

### 
```{r}
Fall <- read_csv("C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\data\\Fallecidos.csv", 
                       col_types = cols(Fallecidos = col_integer(), 
                                        Fecha = col_date(format = "%d/%m/%Y")))
Valor3 <- last(Fall$Fallecidos, na.rm = FALSE)
valueBox(Valor3, caption = "Decesos", color  = '#8E8E8E', icon = "fas fa-ribbon")
    ```

### 
```{r}
Nuevos_casos_nacional <- read_csv("C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\data\\Nuevos_casos_nacional.csv", col_types = cols(Fecha = col_date(format = "%d/%m/%Y"),`Nuevos casos` = col_integer()))
View(Nuevos_casos_nacional)

Valor5 <- last(Nuevos_casos_nacional$`Nuevos casos`, na.rm = FALSE)

valueBox(Valor5, caption = "Nuevos casos", color  = '#FFC519', icon = "fas fa-notes-medical")

    ```

Column {data-height=450}
-------------------------------------
### 

```{r}
Nuevos_casos_departamentos <- read_csv("C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia/data/Nuevos_casos_departamentos.csv", 
                                       col_types = cols(Fecha = col_date(format = "%d/%m/%Y"), 
                                                        `Nuevos casos` = col_integer()))
                                                
diario <- ggplot(Nuevos_casos_departamentos, aes(Fecha, Departamento, fill=`Nuevos casos`)) + 
  geom_tile() + 
  scale_fill_gradient(low = "#ffffff", high = "#170062")+
  labs(title = 'Nuevos casos de coronavirus por departamento y fecha',
       x= 'Fechas', y ='') +
  theme_calc()+
  theme(legend.position = 'top')


mapa_calor <- ggplotly(diario)%>% config ( displayModeBar  =  F) %>% layout(xaxis=list(fixedrange=TRUE)) %>% 
  layout(yaxis=list(fixedrange=TRUE)) 
mapa_calor

```   

Column 
-------------------------------------
### 
    
```{r}
Nuevos_casos_nacional <- read_csv("C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\data\\Nuevos_casos_nacional.csv")

barras <- Nuevos_casos_nacional %>% 
hchart(name = 'Nuevos casos', 'column', hcaes(x= 'Fecha', y= `Nuevos casos`)) %>% 
  hc_colors('#5FCAD8') %>% 
hc_plotOptions(column = list(pointWidth= 8)) %>% 
  hc_title(text = "Nuevos casos a nivel nacional") %>% 
   hc_add_theme(hc_theme_elementary())
barras
  
```

### 
    
```{r}
Confirmados <- read_csv("C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\data\\Confirmados.csv", 
                        col_types = cols(`Casos confirmados` = col_integer(), 
                                         Fecha = col_date(format = "%d/%m/%Y")))

Fallecidos <- read_csv("C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\data\\Fallecidos.csv", 
                       col_types = cols(Fallecidos = col_integer(), 
                                        Fecha = col_date(format = "%d/%m/%Y")))

Recuperados <- read_csv("C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\data\\Recuperados.csv", 
                        col_types = cols(Fecha = col_date(format = "%d/%m/%Y"), 
                                         Recuperados = col_integer()))

Confirmados_xts <- xts(Confirmados$`Casos confirmados`, order.by = Confirmados$Fecha, frequency = 1)

Fallecidos_xts <- xts(Fallecidos$Fallecidos, order.by = Fallecidos$Fecha, frequency = 1)
Recuperados_xts <- xts(Recuperados$Recuperados, order.by = Recuperados$Fecha, frequency = 1)

dinamico <- cbind(Confirmados_xts, Fallecidos_xts, Recuperados_xts)

grafico <- dygraph(dinamico, ylab = 'Cantidad',
                   main = 'Total de casos confirmados, recuperados y fallecidos') %>% 
  dySeries('Confirmados_xts', label = 'Casos') %>% 
  dySeries('Fallecidos_xts', label = 'Fallecidos') %>% 
  dySeries('Recuperados_xts', label = 'Recuperados') %>% 
  dyOptions(colors = c('Blue', 'Black', 'Green')) %>% 
  dyHighlight(highlightCircleSize = 5, 
              highlightSeriesBackgroundAlpha = 0.2,
              hideOnMouseOut = FALSE) %>% 
  dyHighlight(highlightSeriesOpts = list(strokeWidth = 2)) %>% 
  dyRangeSelector(height = 20)
grafico


```


Column 
-------------------------------------
###
```{r}
Acumulado_departamento <- read_csv('C:\\Users\\Asus\\Documents\\Datos COVID-19 Bolivia\\data\\Acumulado_departamento.csv', 
    col_types = cols(Beni = col_integer(), 
        Chuquisaca = col_integer(), Cochabamba = col_integer(), 
        `La Paz` = col_integer(), Oruro = col_integer(), 
        Pando = col_integer(), `Potosí` = col_integer(), 
        `Santa Cruz` = col_integer(), Tarija = col_integer()))

Nuevo <- Acumulado_departamento %>% gather('Departamentos', 'Casos', 2:10)

departamentos <- Nuevo %>% 
  hchart('line', hcaes(x='Fecha', y='Casos', group = 'Departamentos')) %>% 
  hc_colors(c('#FF0000', '#800000', '#FFFF00', '#808000', '#008000', '#00FFFF', '#008080', '#000080', '#800080')) %>% 
  hc_title(text = "Acumulado de casos confirmados por departamentos") %>% 
 hc_add_theme(hc_theme_smpl())

  
departamentos

```

###
```{r}
mapdata <- get_data_from_map(download_map_data('countries/bo/bo-all'))

'Casos confirmados' <- mapdata %>% 
  select(Departamento = 'name') 
`Casos confirmados`$Casos = c(355, 246, 55, 679, 138, 39, 2982, 13, 12)

mapa <- hcmap('countries/bo/bo-all', data = `Casos confirmados`,
      joinBy = c("name", "Departamento"), name = "Casos confirmados", value = "Casos",
      dataLabels = list(enabled = F, format = '{point.name}',
      borderColor = "#000000", borderWidth = 0.5)) %>% 
  hc_title(text = "Mapa: cantidad de casos confirmados") %>% 
  hc_add_theme(hc_theme_elementary())
mapa


```

